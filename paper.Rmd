---
title: "STAT 400 Monte Carlo Project DRAFT"
author: "Group 7: Theyab Alkhoori, Kelsey Britton"
output: pdf_document
---
# Introduction

The population-attributable fraction (PAF) is used in epidemiology to quantify how many cases of a disease can be attributed to a specific exposure or the reduction in cases that could be achieves if the exposure were to be eliminated (https://pmc.ncbi.nlm.nih.gov/articles/PMC1508384/?page=1). PAF can be defined as: 

\[
PAF = \frac{P_e(RR-1)}{P_e(RR-1)+1}
\]

where $P_e$ is the proportion of the population that is exposed and RR is the relative risk, or the proportion of cases in the exposed over the proportion in the unexposed (https://pmc.ncbi.nlm.nih.gov/articles/PMC1508384/?page=3).

The article *A Comparison of Green, Delta, and Monte Carlo Methods to Select an Optimal Approach for Calculating the 95% Confidence Interval of the Population-Attributable Fraction.* by Lee et al. compared three methods for computing confidence intervals for PAFs: 

- Green method  
- Delta method  
- Monte Carlo method  

This project aims to replicate two of the scenarios used in the article and extend this by evaluating how often the three methods produce intervals that are outside of the logical bound of [0,1], which would indicate a proportion of the cases either less than 0% or greater than 100%.

# Methods

## Simulation Overview

We replicated the simulation design from the article *A Comparison of Green, Delta, and Monte Carlo Methods…* to estimate the Population-Attributable Fraction (PAF) and compare three confidence interval (CI) methods: the Delta method, the Greenland (Green) method, and the Monte Carlo method based on two scenarios in Lee et al. (2024):

-Scenario A: Modest effect size (RR = 1.2), moderate prevalence (Pe = 0.10), sample size Tp = 1,000.

-Scenario B: Strong effect size (RR = 5.0), same prevalence, large sample size Tp = 100,000.

Then a simulation study with $n = 500$ iterations was performed on each scenario to determine the proportion of CIs containign the true PAF, average CI width, and the the proportion of CIs that violated the [0,1] boundary.

---
## Notations and definitions in this study
- **PAF**: Population-attributable fraction  
- **Pe**: Prevalence of exposure in the total population  
- **RR**: Relative risk for the exposed group  
- **Tp**: Total population size  
- **V[β]**: Variance of the log(RR) estimator  
- **V[Pe]**: Variance of the exposure prevalence estimator  
- **CI**: 95% confidence interval for the PAF  

## PAF Formula
The PAF was estimated using the Levin formula, which depends on the exposure prevalence and the risk ratio:

\[
PAF = \frac{Pe(RR - 1)}{Pe(RR - 1) + 1}
\]

This formula is implemented in the function `paf_single()`.

---

## Confidence Interval Methods

### Delta Method
The Delta method uses a Taylor series approximation to estimate the variance of the PAF estimator.  
The variance of PAF is computed using the variances of Pe and β (log(RR)), following the structure:

\[
V[\widehat{PAF}] = \frac{V[Pe](RR - 1)^2 + V[β](RR \cdot Pe)^2}{(Pe(RR - 1) + 1)^4}
\]

A 95% CI is then constructed as:

\[
PAF \pm 1.96 \times \sqrt{V[\widehat{PAF}]}
\]

This procedure is implemented in `delta_paf_ci()`.

---

### Greenland (Green) Method
The Greenland method uses a variance-stabilizing transformation of \(1 - PAF\), incorporating the odds of exposure:

\[
O = \frac{Pe}{1 - Pe}
\]

This method accounts for variability in both the RR and Pe.  
After computing the transformed variance, the 95% CI is back-transformed to the PAF scale:

\[
CI = 1 - (1 - PAF) \exp(\pm 1.96 \sqrt{V[\widehat{PAF}]})
\]

Implemented in `greenland_paf_ci()`.

---

### Monte Carlo Method
The Monte Carlo method generates random samples for log(RR) and Pe:

- \( \beta = \log(RR) \) is sampled from a normal distribution with variance V[β]  
- Pe is sampled from a binomial distribution with variance V[Pe]

For each simulation, a new PAF is computed.  
The 95% CI is defined as the 2.5th and 97.5th percentiles of the simulated PAF distribution.

Implemented in `mc_paf_ci()`.

---

## Simulation Design

For each scenario, we:

1. Drew RR* from a log-normal distribution and Pe* from a binomial distribution.
2. Computed CIs using the three methods.
3. Recorded Ci coverage and width.
4. Calculated the proportion of CIs that had values outside of our logical boundaries.

---
# Results



# Discussion

# References
ADD FOR FINAL