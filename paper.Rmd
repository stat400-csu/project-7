---
title: "Comparing Greenland, Delta, and Monte Carlo Methods for PAF Confidence Intervals"
subtitle: "STAT 400"
author: "Group 7: Kelsey Britton & Theyab Alkhoori"
output: html_document
---
 
```{r setup, include=FALSE}

source("Group7SlidesSTAT400CodeSource.R") 
knitr::opts_chunk$set(echo = FALSE)

```

# Introduction

The population-attributable fraction (PAF) is used in epidemiology to quantify how many cases of a disease can be attributed to a specific exposure or the reduction in cases that could be achieves if the exposure were to be eliminated (https://pmc.ncbi.nlm.nih.gov/articles/PMC1508384/?page=1). PAF can be defined as: 

\[
PAF = \frac{P_e(RR-1)}{P_e(RR-1)+1}
\]

where $P_e$ is the proportion of the population that is exposed and RR is the relative risk, the ratio of the risk of disease among the exposed group to the risk among the unexposed group (https://pmc.ncbi.nlm.nih.gov/articles/PMC1508384/?page=3). 

While point estimates of the population-attributable fraction (PAF) are informative, they do not express uncertainty arising from estimation of exposure prevalence and relative risk. Confidence intervals (CIs) are therefore essential for interpreting PAF estimates and for informing public health decision-making. However, because the PAF is a proportion, it is logically bounded between 0 and 1. Standard CI methods based on large-sample normal approximations may violate these bounds, producing negative values or values exceeding one, which are not interpretable for epidemiology. This limitation motivates the comparison of alternative CI methods that better account for the nonlinearity and bounded nature of the PAF.

The article *A Comparison of Green, Delta, and Monte Carlo Methods to Select an Optimal Approach for Calculating the 95% Confidence Interval of the Population-Attributable Fraction.* by Lee et al. compared three methods for computing confidence intervals for PAFs: 

- Green method  
- Delta method  
- Monte Carlo method  

This project aims to replicate two of the scenarios used in the article and extend this by evaluating how often the three methods produce intervals that are outside of the logical bound of [0,1], which would indicate a proportion of the cases either less than 0% or greater than 100%.

# Methods

## Simulation Overview

We replicated the simulation design from the article *A Comparison of Green, Delta, and Monte Carlo Methods…* to estimate the Population-Attributable Fraction (PAF) and compare three confidence interval (CI) methods: the Delta method, the Greenland (Green) method, and the Monte Carlo method based on two scenarios in Lee et al. (2024):

-Scenario A: Modest effect size ($RR$ = 1.2), moderate prevalence ($P_e$ = 0.10), sample size $T_p$ = 1,000.

-Scenario B: Strong effect size ($RR$ = 5.0), same prevalence, large sample size $T_p$ = 100,000.

Then a simulation study with $n = 500$ iterations was performed on each scenario to determine the proportion of CIs containing the true PAF, average CI width, and the the proportion of CIs that violated the [0,1] boundary.


## Notations and definitions in this study
- **PAF**: Population-attributable fraction  
- $P_e$: Prevalence of exposure in the total population  
- **RR**: Relative risk for the exposed group  
- $T_p$: Total population size  
- **V[**$\beta$**]**: Variance of the log(RR) estimator  
- **V[**$P_e$**]**: Variance of the exposure prevalence estimator  
- **CI**: 95% confidence interval for the PAF  

## PAF Formula

The PAF was estimated using the Levin formula, which depends on the exposure prevalence and the risk ratio:

\[
PAF = \frac{Pe(RR - 1)}{Pe(RR - 1) + 1}
\]

---

## Confidence Interval Methods

### Delta Method

The Delta method uses a Taylor series approximation to estimate the variance of the PAF estimator.  
The variance of PAF is computed using the variances of $P_e$ and $\beta$ (log(RR)), following the structure:

\[
V[\widehat{PAF}] = \frac{V[P_e](RR - 1)^2 + V[β](RR \cdot P_e)^2}{(P_e (RR - 1) + 1)^4}
\]

A 95% CI is then constructed as:

\[
PAF \pm 1.96 \times \sqrt{V[\widehat{PAF}]}
\]

### Greenland Method

The Greenland method uses a variance-stabilizing transformation of \(1 - PAF\), incorporating the odds of exposure:

\[
O = \frac{Pe}{1 - Pe}
\]

This method accounts for variability in both the RR and Pe.  
After computing the transformed variance, the 95% CI is back-transformed to the PAF scale:

\[
CI = 1 - (1 - PAF) \exp(\pm 1.96 \sqrt{V[\widehat{PAF}]})
\]


### Monte Carlo Method

The Monte Carlo method generates random samples for log(RR) and Pe:

- \( \beta = \log(RR) \) is sampled from a normal distribution with variance V[$\beta$]  
- $P_e$ is sampled from a binomial distribution with variance V[$P_e$]

For each simulation, a new PAF is computed.  
The 95% CI is defined as the 2.5th and 97.5th percentiles of the simulated PAF distribution.

## Simulation Design

For each scenario, we:

1. Drew $RR^*$ from a log-normal distribution and $P_e^*$ from a binomial distribution.
2. Computed CIs using the three methods.
3. Recorded CI coverage and width.

In addition, we noted whether each confidence interval extended outside the logical bounds of [0,1]. This extension provides a practical assessment of interpretability, as confidence intervals outside this range cannot represent valid population proportions. Although this was not evaluated in the original study by Lee et al. (2024), it is highly relevant for applied epidemiological research and motivated our extension of their simulation framework.

# Results

Scenario A had a modest effect size (RR = 1.2), moderate prevalence (Pe = 0.10), sample size T_p = 1,000, and a true PAF = 0.0196
```{r}
scenarioA_results
```

```{r}
coverage_width_A
```

```{r}
boundary_A
```

```{r}
scenarioB_results
```

```{r}
coverage_width_B
```
```{r}
boundary_B
```


# Discussion

This study compared three methods for constructing confidence intervals for the population-attributable fraction (PAF): the Delta method, the Greenland method, and a Monte Carlo simulation–based approach. Using two parameter scenarios taken directly from Lee et al. (2024), we evaluated how these methods behave under small PAF values with modest effect size (Scenario A) and large PAF values with strong effect size (Scenario B). Across both settings, our results were consistent with the patterns reported by Lee et al., supporting their conclusions.

Our extension analysis further emphasized the importance of boundary-aware CI methods. By evaluating how often each method generated values outside the [0,1] range, we showed that Monte Carlo provides the best protection against invalid intervals in both mild (Scenario A) and extreme (scenario B) parameter settings. Our simulation suggests that the Monte Carlo method provides the most reliable confidence interval estimation for the population-attributable fraction.

# References
ADD FOR FINAL
